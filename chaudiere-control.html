<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contr√¥le Chaudi√®re Chaffoteaux MIRA C GREEN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 13px;
            font-weight: 500;
        }

        .connection-status.connected {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid rgba(40, 167, 69, 0.5);
        }

        .connection-status.disconnected {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid rgba(220, 53, 69, 0.5);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .connected .status-dot {
            background: #28a745;
        }

        .disconnected .status-dot {
            background: #dc3545;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #666;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .status-card-title {
            color: #666;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-card-value {
            color: #333;
            font-size: 24px;
            font-weight: 700;
        }

        .status-card-unit {
            color: #999;
            font-size: 16px;
            font-weight: 500;
        }

        .temp-control {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            color: white;
        }

        .temp-control-title {
            text-align: center;
            font-size: 14px;
            margin-bottom: 20px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .temp-display {
            text-align: center;
            margin-bottom: 25px;
        }

        .temp-display h2 {
            font-size: 56px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .temp-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .temp-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .temp-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .temp-btn:active {
            transform: scale(0.95);
        }

        .temp-slider {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            -webkit-appearance: none;
        }

        .temp-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .temp-slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .temp-range {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 13px;
            opacity: 0.8;
        }

        .action-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .loading {
            display: none;
            text-align: center;
            color: #667eea;
            margin: 15px 0;
            font-weight: 500;
        }

        .loading.show {
            display: block;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }

        .message.show {
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-size: 14px;
        }

        .info-value {
            color: #333;
            font-size: 16px;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 10px 16px;
                font-size: 14px;
                white-space: nowrap;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }

            .temp-display h2 {
                font-size: 48px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Contr√¥le Chaudi√®re</h1>
            <p class="subtitle">Chaffoteaux MIRA C GREEN 25 - BridgeNET</p>
            <div id="connectionStatus" class="connection-status disconnected">
                <div class="status-dot"></div>
                <span>D√©connect√©</span>
            </div>
        </div>

        <div class="content">
            <div id="message" class="message"></div>
            <div id="loading" class="loading">‚è≥ Chargement...</div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('heating')">üî• Chauffage</button>
                <button class="tab" onclick="switchTab('dhw')">üíß Eau Chaude</button>
                <button class="tab" onclick="switchTab('status')">üìä √âtat</button>
                <button class="tab" onclick="switchTab('advanced')">‚öôÔ∏è Avanc√©</button>
            </div>

            <!-- Onglet Chauffage -->
            <div id="heating-tab" class="tab-content active">
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-card-title">Temp. D√©part</div>
                        <div class="status-card-value" id="waterTempOut">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                    <div class="status-card">
                        <div class="status-card-title">Temp. Retour</div>
                        <div class="status-card-value" id="waterTempIn">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                    <div class="status-card">
                        <div class="status-card-title">Temp. Pi√®ce Z1</div>
                        <div class="status-card-value" id="z1RoomTemp">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                    <div class="status-card">
                        <div class="status-card-title">Temp. Ext√©rieure</div>
                        <div class="status-card-value" id="extTemp">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                </div>

                <div class="temp-control">
                    <div class="temp-control-title">Temp√©rature Eau de Chauffage (Mode Fixe)</div>
                    <div class="temp-display">
                        <h2 id="setTemp">50.0</h2>
                        <span style="font-size: 18px;">¬∞C</span>
                    </div>

                    <div class="temp-buttons">
                        <button class="temp-btn" onclick="adjustTemp(-0.5)">‚àí</button>
                        <button class="temp-btn" onclick="adjustTemp(0.5)">+</button>
                    </div>

                    <input type="range"
                           id="tempSlider"
                           class="temp-slider"
                           min="35"
                           max="65"
                           value="50"
                           step="0.5"
                           oninput="updateTempDisplay(this.value)">
                    <div class="temp-range">
                        <span>35¬∞C</span>
                        <span>65¬∞C</span>
                    </div>
                </div>

                <button class="action-btn btn-primary" onclick="setHeatingTemp()">
                    ‚úì Appliquer la temp√©rature
                </button>

                <button class="action-btn btn-secondary" onclick="refreshStatus()">
                    üîÑ Actualiser
                </button>
            </div>

            <!-- Onglet Eau Chaude -->
            <div id="dhw-tab" class="tab-content">
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-card-title">Temp. Actuelle</div>
                        <div class="status-card-value" id="dhwRealTemp">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                    <div class="status-card">
                        <div class="status-card-title">Temp. Cible</div>
                        <div class="status-card-value" id="dhwTargetTemp">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                    <div class="status-card">
                        <div class="status-card-title">Temp. Antigel</div>
                        <div class="status-card-value" id="dhwAntifreezeTemp">--</div>
                        <div class="status-card-unit">¬∞C</div>
                    </div>
                    <div class="status-card">
                        <div class="status-card-title">Statut</div>
                        <div class="status-card-value" id="dhwStatusValue">--</div>
                    </div>
                </div>

                <div class="temp-control">
                    <div class="temp-control-title">Temp√©rature Eau Chaude Sanitaire</div>
                    <div class="temp-display">
                        <h2 id="setDhwTemp">50.0</h2>
                        <span style="font-size: 18px;">¬∞C</span>
                    </div>

                    <div class="temp-buttons">
                        <button class="temp-btn" onclick="adjustDhwTemp(-1)">‚àí</button>
                        <button class="temp-btn" onclick="adjustDhwTemp(1)">+</button>
                    </div>

                    <input type="range"
                           id="dhwTempSlider"
                           class="temp-slider"
                           min="35"
                           max="65"
                           value="50"
                           step="1"
                           oninput="updateDhwTempDisplay(this.value)">
                    <div class="temp-range">
                        <span>35¬∞C</span>
                        <span>65¬∞C</span>
                    </div>
                </div>

                <button class="action-btn btn-primary" onclick="setDhwTemp()">
                    ‚úì Appliquer la temp√©rature
                </button>

                <div style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">Mode Confort</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="dhwComfortMode" onchange="setDhwComfortMode()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Onglet √âtat -->
            <div id="status-tab" class="tab-content">
                <div class="status-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">√âtat de la Chaudi√®re</h3>
                    <div class="info-row">
                        <span class="info-label">Statut G√©n√©ral</span>
                        <span class="info-value" id="boilerStatus">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Statut Chauffage</span>
                        <span class="info-value" id="heatingStatus">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Flamme</span>
                        <span class="info-value" id="heatingFlame">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Vitesse Ventilateur</span>
                        <span class="info-value" id="fanSpeed">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Cycles d'Allumage</span>
                        <span class="info-value" id="ignitionCycles">--</span>
                    </div>
                </div>

                <div class="status-card">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Zone 1</h3>
                    <div class="info-row">
                        <span class="info-label">Activation Chauffage</span>
                        <span class="info-value" id="z1HeatingActivation">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temp√©rature Cible</span>
                        <span class="info-value" id="z1TargetTemp">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temp√©rature Pi√®ce</span>
                        <span class="info-value" id="z1RoomTempStatus">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temp. Eau Max</span>
                        <span class="info-value" id="z1WaterMaxTemp">--</span>
                    </div>
                </div>

                <button class="action-btn btn-secondary" onclick="refreshStatus()" style="margin-top: 20px;">
                    üîÑ Actualiser
                </button>
            </div>

            <!-- Onglet Avanc√© -->
            <div id="advanced-tab" class="tab-content">
                <div class="status-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Param√®tres Thermor√©gulation Z1</h3>
                    <div class="info-row">
                        <span class="info-label">Pente</span>
                        <span class="info-value" id="z1ThermoregSlope">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">D√©calage</span>
                        <span class="info-value" id="z1ThermoregOffset">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temp. Jour</span>
                        <span class="info-value" id="z1DayTemp">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temp. Nuit</span>
                        <span class="info-value" id="z1NightTemp">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temp. Fixe</span>
                        <span class="info-value" id="z1FixedTemp">--</span>
                    </div>
                </div>

                <div class="status-card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">√âtat SRA</h3>
                    <div class="info-row">
                        <span class="info-label">Statut SRA</span>
                        <span class="info-value" id="sraStatus">--</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Temps Boost</span>
                        <span class="info-value" id="boostTime">--</span>
                    </div>
                </div>

                <div class="status-card">
                    <h3 style="margin-bottom: 15px; color: #dc3545;">Erreurs</h3>
                    <div class="info-row">
                        <span class="info-label">Code Erreur</span>
                        <span class="info-value" id="errorCode">--</span>
                    </div>
                </div>

                <button class="action-btn btn-secondary" onclick="refreshStatus()" style="margin-top: 20px;">
                    üîÑ Actualiser
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Utilise l'IP du serveur actuel
        const EBUSD_HOST = window.location.hostname || 'localhost';
        const EBUSD_HTTP_PORT = 8889;
        const EBUSD_API = `http://${EBUSD_HOST}:${EBUSD_HTTP_PORT}`;

        let currentSetTemp = 50;
        let currentDhwTemp = 50;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            // Actualisation automatique toutes les 30 secondes
            setInterval(refreshStatus, 30000);
        });

        function switchTab(tabName) {
            // Cacher tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Afficher l'onglet s√©lectionn√©
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('show', show);
        }

        function showMessage(message, type = 'error') {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type} show`;
            setTimeout(() => messageDiv.classList.remove('show'), 5000);
        }

        function updateConnectionStatus(connected) {
            const statusDiv = document.getElementById('connectionStatus');
            if (connected) {
                statusDiv.className = 'connection-status connected';
                statusDiv.innerHTML = '<div class="status-dot"></div><span>Connect√©</span>';
            } else {
                statusDiv.className = 'connection-status disconnected';
                statusDiv.innerHTML = '<div class="status-dot"></div><span>D√©connect√©</span>';
            }
        }

        function updateTempDisplay(value) {
            currentSetTemp = parseFloat(value);
            document.getElementById('setTemp').textContent = currentSetTemp.toFixed(1);
        }

        function adjustTemp(delta) {
            const slider = document.getElementById('tempSlider');
            let newValue = parseFloat(slider.value) + delta;
            newValue = Math.max(5, Math.min(35, newValue));
            slider.value = newValue;
            updateTempDisplay(newValue);
        }

        function updateDhwTempDisplay(value) {
            currentDhwTemp = parseFloat(value);
            document.getElementById('setDhwTemp').textContent = currentDhwTemp.toFixed(1);
        }

        function adjustDhwTemp(delta) {
            const slider = document.getElementById('dhwTempSlider');
            let newValue = parseFloat(slider.value) + delta;
            newValue = Math.max(35, Math.min(65, newValue));
            slider.value = newValue;
            updateDhwTempDisplay(newValue);
        }

        async function ebusCommand(command) {
            try {
                const response = await fetch(`${EBUSD_API}/data/${command}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/plain'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.text();
                return data.trim();
            } catch (error) {
                console.error('Erreur eBUS:', error);
                throw error;
            }
        }

        async function ebusWrite(command, value) {
            try {
                const response = await fetch(`${EBUSD_API}/data/${command}/write?${value}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'text/plain'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.text();
                return data.trim();
            } catch (error) {
                console.error('Erreur eBUS write:', error);
                throw error;
            }
        }

        function updateElement(id, value, unit = '') {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = (value && value !== '-' && value !== '') ? value + unit : '--';
            }
        }

        async function refreshStatus() {
            showLoading(true);

            try {
                // Temp√©ratures eau (chauffage)
                const waterTempOut = await ebusCommand('water_temp_out');
                updateElement('waterTempOut', waterTempOut);

                const waterTempIn = await ebusCommand('water_temp_in');
                updateElement('waterTempIn', waterTempIn);

                // Temp√©rature ext√©rieure
                const extTemp = await ebusCommand('ext_temp');
                updateElement('extTemp', extTemp);

                // Zone 1
                const z1RoomTemp = await ebusCommand('z1_room_temp');
                updateElement('z1RoomTemp', z1RoomTemp);
                updateElement('z1RoomTempStatus', z1RoomTemp, ' ¬∞C');

                const z1TargetTemp = await ebusCommand('z1_target_temp');
                updateElement('z1TargetTemp', z1TargetTemp, ' ¬∞C');
                if (z1TargetTemp && z1TargetTemp !== '-') {
                    document.getElementById('tempSlider').value = parseFloat(z1TargetTemp);
                    updateTempDisplay(parseFloat(z1TargetTemp));
                }

                const z1HeatingActivation = await ebusCommand('z1_heating_activation');
                updateElement('z1HeatingActivation', z1HeatingActivation);

                const z1WaterMaxTemp = await ebusCommand('z1_water_max_temp');
                updateElement('z1WaterMaxTemp', z1WaterMaxTemp, ' ¬∞C');

                // DHW (Eau Chaude Sanitaire)
                const dhwStatus = await ebusCommand('dhw_status');
                updateElement('dhwStatusValue', dhwStatus);

                const dhwRealTemp = await ebusCommand('dhw_real_temp');
                updateElement('dhwRealTemp', dhwRealTemp);

                const dhwTargetTemp = await ebusCommand('dhw_target_temp');
                updateElement('dhwTargetTemp', dhwTargetTemp);
                if (dhwTargetTemp && dhwTargetTemp !== '-') {
                    document.getElementById('dhwTempSlider').value = parseFloat(dhwTargetTemp);
                    updateDhwTempDisplay(parseFloat(dhwTargetTemp));
                }

                const dhwAntifreezeTemp = await ebusCommand('dhw_antifreeze_temp');
                updateElement('dhwAntifreezeTemp', dhwAntifreezeTemp);

                const dhwComfortMode = await ebusCommand('dhw_comfort_mode_status');
                if (dhwComfortMode && dhwComfortMode !== '-') {
                    document.getElementById('dhwComfortMode').checked = (dhwComfortMode === '1' || dhwComfortMode.toLowerCase() === 'on');
                }

                // √âtat chaudi√®re
                const boilerStatus = await ebusCommand('boiler_status');
                updateElement('boilerStatus', boilerStatus);

                const heatingStatus = await ebusCommand('heating_status');
                updateElement('heatingStatus', heatingStatus);

                const heatingFlame = await ebusCommand('heating_flame');
                updateElement('heatingFlame', heatingFlame);

                const fanSpeed = await ebusCommand('fan_speed');
                updateElement('fanSpeed', fanSpeed, ' rpm');

                const ignitionCycles = await ebusCommand('ignition_cycles');
                updateElement('ignitionCycles', ignitionCycles);

                // Param√®tres avanc√©s
                const z1ThermoregSlope = await ebusCommand('z1_thermoreg_slope');
                updateElement('z1ThermoregSlope', z1ThermoregSlope);

                const z1ThermoregOffset = await ebusCommand('z1_thermoreg_offset');
                updateElement('z1ThermoregOffset', z1ThermoregOffset);

                const z1DayTemp = await ebusCommand('z1_day_temp');
                updateElement('z1DayTemp', z1DayTemp, ' ¬∞C');

                const z1NightTemp = await ebusCommand('z1_night_temp');
                updateElement('z1NightTemp', z1NightTemp, ' ¬∞C');

                const z1FixedTemp = await ebusCommand('z1_fixed_temp');
                updateElement('z1FixedTemp', z1FixedTemp, ' ¬∞C');

                const sraStatus = await ebusCommand('sra_status');
                updateElement('sraStatus', sraStatus);

                const boostTime = await ebusCommand('boost_time');
                updateElement('boostTime', boostTime, ' s');

                const errorCode = await ebusCommand('error_code');
                updateElement('errorCode', errorCode);

                updateConnectionStatus(true);
            } catch (error) {
                console.error('Erreur lors de la r√©cup√©ration du statut:', error);
                updateConnectionStatus(false);
                showMessage('Impossible de se connecter √† la chaudi√®re. V√©rifiez que ebusd est d√©marr√©.', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function setHeatingTemp() {
            showLoading(true);

            try {
                const temp = currentSetTemp.toFixed(1);

                // √âcrire la temp√©rature fixe de l'eau de chauffage pour la zone 1
                await ebusWrite('z1_fixed_temp', temp);

                showMessage(`‚úì Temp√©rature eau de chauffage r√©gl√©e √† ${temp}¬∞C`, 'success');

                // Actualiser le statut apr√®s 2 secondes
                setTimeout(refreshStatus, 2000);

            } catch (error) {
                console.error('Erreur lors du r√©glage de la temp√©rature:', error);
                showMessage('Erreur lors du r√©glage de la temp√©rature. Veuillez r√©essayer.', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function setDhwTemp() {
            showLoading(true);

            try {
                const temp = currentDhwTemp.toFixed(1);

                // √âcrire la temp√©rature cible DHW
                await ebusWrite('dhw_target_temp', temp);

                showMessage(`‚úì Temp√©rature eau chaude r√©gl√©e √† ${temp}¬∞C`, 'success');

                // Actualiser le statut apr√®s 2 secondes
                setTimeout(refreshStatus, 2000);

            } catch (error) {
                console.error('Erreur lors du r√©glage de la temp√©rature DHW:', error);
                showMessage('Erreur lors du r√©glage de la temp√©rature. Veuillez r√©essayer.', 'error');
            } finally {
                showLoading(false);
            }
        }

        async function setDhwComfortMode() {
            showLoading(true);

            try {
                const checkbox = document.getElementById('dhwComfortMode');
                const value = checkbox.checked ? '1' : '0';

                await ebusWrite('dhw_comfort_mode_status_w', value);

                showMessage(`‚úì Mode confort ${checkbox.checked ? 'activ√©' : 'd√©sactiv√©'}`, 'success');

                // Actualiser le statut apr√®s 2 secondes
                setTimeout(refreshStatus, 2000);

            } catch (error) {
                console.error('Erreur lors du changement du mode confort:', error);
                showMessage('Erreur lors du changement du mode confort.', 'error');
                // Remettre la checkbox dans son √©tat pr√©c√©dent
                document.getElementById('dhwComfortMode').checked = !document.getElementById('dhwComfortMode').checked;
            } finally {
                showLoading(false);
            }
        }
    </script>
</body>
</html>
